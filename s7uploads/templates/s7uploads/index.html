{% extends "s7uploads/navbar.html" %}

{% load static %}
{% load url_tags %}
{% load upload_tags %}

{% block content %}

<section id="main-content">

{% if user %}
	{% if user.is_anonymous %}
		<section id="userbanner-nolog">
			<h4>You are not logged in!</h4>
		</section>
	{% else %}
		<section id="userbanner">
			<img src="/static/s7uploads/images/default_profile.jpg"></img>
			<section id="userbannertext">
			<h3><a href="{% url 's7uploads:index' %}?tags={{user.username}}">{{ user.username }}</a></h3>
			<h5>{{ s7user.num_uploads }} uploads</h5>
			<h5>{{ s7user.num_reviews }} reviews</h5>
			<section id="sideupload">
			<a href="{%url 's7uploads:new_upload' %}">+ Upload</a>
			</section>
			</section>
		</section>
	{% endif %}
{% endif %}

<section id="sidebar">
	<section id="sidebar-content">
	<h2>Search:</h2>
    <form action="search_uploads/?{{ request.GET.urlencode }}" method="post">
        {% csrf_token %}
        {% for field in search_form %}
        {{ field }}
        {% endfor %}
    </form>
	<h2>Sort by:</h2>
	<ul>
		<li> <a href="?{% update_query request order_by='-date_added' %}">Newest</a></li>
		<li> <a href="?{% update_query request order_by='date_added' %}">Oldest</a></li>
		<li> <a href="?{% update_query request order_by='ratings' %}">Best Rated</a></li>
    <h2>Filter by:</h2>
	<ul>
		<li> <a href="?{% toggle_query request filter='map' %}">Maps</a></li>
		<li> <a href="?{% toggle_query request filter='scenario' %}">Scenarios</a></li>
		<li> <a href="?{% toggle_query request filter='plugin#script' %}">Plugins + Scripts</a></li>
		<li> <a href="?{% toggle_query request filter='utility' %}">Utilities</a></li>
		<li> <a href="?{% toggle_query request filter='physics' %}">Physics</a></li>
	</ul>
    <br>

	</section>
</section>

<section id="uploadlist">
<section id="upload">

{% if latest_upload_list %}

	<ul>
	{% for upload in latest_upload_list %}
		{% with upload.upload_id as u %}

		<li>
		{% if upload.upload_id.screenshot_set.exists %}
		<section id="imgcrop">
            		<img src="{% get_media_prefix %}{{upload.upload_id.indexScreenshot}}" alt="{% get_media_prefix %}{{upload.upload_id.indexScreenshot}}" id="middle"></img>
		</section>
		{% endif %}
		

		<section id="indexuploadtext">
			<h2><a href="{%url 's7uploads:upload' upload.id %}">{{ u.title }} {{ upload.version_name }}</a></h2>
			<a id="download" href="{%url 's7uploads:download' upload.id %}">Download</a>
			{% if user|user_owns_upload:upload.user %}
			<a id="download" href="{%url 's7uploads:edit' upload.id %}">Edit</a>
			{% endif %}
			<h3>{{ u.user.user.username }} on {{ upload.date_added }} </h3>
			<p>{{ u.description|truncatewords:20 }}</p>
			<h4> Version {{upload.version_name}} Notes: </h4>
			<p> {{ upload.version_notes|truncatewords:10 }} </p>
		</section>
		<section id="indexuploadtext">
			<p>
			{% for tag in upload.tags.all %}
			#{{tag.name}}
			{% endfor %}
			<br>
			{{u.total_downloads}} downloads, {{upload.total_stars}} stars
			</p>
		</section>
		</li>
			{% endwith %}
	{% endfor %}
	</ul>

{% else %}

	<p> Nothing to see here. </p>

{% endif %}

<section id="pagenums">
{% for page in num_pages %}
	<a href="{% url 's7uploads:index' page %}?{{request.GET.urlencode}}">{{page}}</a>
{% endfor %}
</section>

</section>
</section>

</section>
{% endblock %}
